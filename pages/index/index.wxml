<!--index.wxml-->
<view class="container {{currentTheme ? currentTheme.key + '-theme' : 'classic-theme'}}">

  <!-- 内容区域 -->
  <view class="content-wrapper slide-up" style="padding-top: 40rpx;">
    
    <!-- 空状态 -->
    <view wx:if="{{isEmpty}}" class="empty-state fade-in">
      <view class="empty-content">
        <view class="empty-icon">🎂</view>
        <view class="empty-title">开始记录生日</view>
        <view class="empty-subtitle">
          添加亲友的生日信息<br/>
          让每个重要时刻都不错过
        </view>
        <view class="gesture-button" bindtap="addBirthday">
          <view class="gesture-hand">
            <view class="hand-emoji">👆</view>
            <view class="gesture-text">点击添加</view>
          </view>
          <view class="gesture-sparkles">
            <view class="sparkle sparkle-1">✨</view>
            <view class="sparkle sparkle-2">✨</view>
            <view class="sparkle sparkle-3">✨</view>
          </view>
        </view>
      </view>
    </view>

    <!-- 有数据状态 -->
    <view wx:else class="main-content">
      
      <!-- 即将到来的生日卡片 -->
      <view wx:if="{{upcomingBirthday}}" class="upcoming-section">
        <view class="card-base-white">
          <view class="section-title">
            <text class="icon">🎉</text>
            即将到来的寿星
          </view>

          <view class="upcoming-card card special-birthday-card" bindtap="viewDetail" data-index="0">
          <!-- 庆祝装饰背景 -->
          <view class="celebration-decorations">
            <view class="confetti confetti-1">🎊</view>
            <view class="confetti confetti-2">🎉</view>
            <view class="confetti confetti-3">🎈</view>
            <view class="confetti confetti-4">✨</view>
            <view class="confetti confetti-5">🎁</view>
            <view class="confetti confetti-6">🎂</view>
          </view>

          <!-- 彩带装饰 -->
          <view class="ribbon-decoration ribbon-top"></view>
          <view class="ribbon-decoration ribbon-bottom"></view>

          <!-- 特殊生日标识 -->
          <view class="birthday-crown">👑</view>

          <view class="upcoming-content-compact">
            <!-- 左侧：倒计时圆圈 -->
            <view class="countdown-section">
              <view class="countdown-circle-compact">
                <view class="countdown-number-compact">{{upcomingBirthday.daysLeft}}</view>
                <view class="countdown-unit-compact">天后</view>
              </view>
              <view class="countdown-sparkles-compact">
                <view class="sparkle sp-1">✨</view>
                <view class="sparkle sp-2">💫</view>
                <view class="sparkle sp-3">⭐</view>
              </view>
            </view>

            <!-- 右侧：生日信息 -->
            <view class="birthday-info-compact">
              <view class="name-section-compact">
                <view class="avatar-compact">{{upcomingBirthday.zodiacEmoji}}</view>
                <view class="name-details-compact">
                  <view class="birthday-title-compact">🎂 即将生日</view>
                  <view class="name-compact">{{upcomingBirthday.name}}</view>
                  <view class="tags-compact">
                    <text wx:for="{{upcomingBirthday.tags}}" wx:key="index" class="tag tag-compact">{{item}}</text>
                  </view>
                </view>
              </view>

              <view class="birthday-details-compact">
                <view class="date-info-compact">
                  <text class="icon-compact">🎯</text>
                  {{upcomingBirthday.month}}月{{upcomingBirthday.day}}日
                  <text class="date-type-compact">({{upcomingBirthday.type === 'lunar' ? '农历' : '公历'}})</text>
                </view>

                <view class="meta-info-compact">
                  <view class="meta-item-compact">
                    <text class="icon-compact">🎭</text>
                    {{upcomingBirthday.constellation}}
                  </view>
                  <view class="meta-item-compact">
                    <text class="icon-compact">🎈</text>
                    即将{{upcomingBirthday.nextBirthdayAge}}岁
                  </view>
                </view>
              </view>

              <!-- 生日祝福文字 -->
              <view class="birthday-blessing-compact">
                🌟 准备庆祝这个特别的日子吧！
              </view>
            </view>
          </view>
          </view>
        </view>
      </view>

      <!-- 搜索筛选和生日列表 -->
      <view class="search-and-list-section">
        <view class="card-base-white">
          <!-- 生日列表标题 -->
          <view class="section-header">
            <view class="section-title">
              <text class="icon">📋</text>
              生日列表
              <text class="count-badge">{{filteredBirthdays.length}}</text>
            </view>
            <view class="add-btn" bindtap="addBirthday">
              <text class="add-btn-icon">➕</text>
              <text class="add-btn-text">添加</text>
            </view>
          </view>

          <!-- 搜索和筛选 -->
          <view class="tools-section">
            <view class="search-box">
              <text class="search-icon">🔍</text>
              <input
                class="search-input"
                placeholder="搜索姓名、标签、星座..."
                bindinput="onSearch"
                confirm-type="search"
              />
            </view>

            <view class="filter-tags">
              <scroll-view scroll-x="true" class="tags-scroll">
                <view class="tags-container">
                  <view
                    class="tag {{currentTag === item ? 'active' : ''}}"
                    wx:for="{{allTags}}"
                    wx:key="index"
                    data-tag="{{item}}"
                    bindtap="switchTag"
                  >
                    {{item}}
                  </view>
                </view>
              </scroll-view>
            </view>
          </view>

          <!-- 生日列表内容 -->
          <view class="list-content">

        <!-- 生日条目 -->
        <view class="birthday-list">
          <view 
            class="birthday-item card" 
            wx:for="{{filteredBirthdays}}" 
            wx:key="index" 
            bindtap="viewDetail" 
            data-index="{{index}}"
          >
            <view class="item-content">
              <view class="item-left">
                <view class="avatar">{{item.zodiacEmoji}}</view>
                <view class="basic-info">
                  <view class="name">{{item.name}}</view>
                  <view class="birthday-date">
                    {{item.month}}月{{item.day}}日
                    <text class="age-info"> · {{item.currentAge}}岁</text>
                  </view>
                  <view class="tags-row">
                    <text wx:for="{{item.tags}}" wx:for-item="tag" wx:key="tag" class="tag tag-mini">{{tag}}</text>
                  </view>
                </view>
              </view>
              
              <view class="item-right">
                <view class="days-left">
                  <view class="days-number">{{item.daysLeft}}</view>
                  <view class="days-text">天后</view>
                </view>
                <view class="constellation-info">
                  <text>{{item.constellation}}</text>
                </view>
              </view>
            </view>
          </view>
        </view>
          </view>
        </view>
      </view>
    </view>
  </view>

</view>